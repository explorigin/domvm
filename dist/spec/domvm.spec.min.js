/*
 https://github.com/leeoniya/domvm (3.x-dev, spec build)
*/
(function(G,A){"object"===typeof exports&&"undefined"!==typeof module?module.exports=A():"function"===typeof define&&define.amd?define(A):G.domvm=A()})(this,function(){"use strict";function G(){}function A(a){return null!=a&&a.constructor===Object}function ma(a){a=typeof a;return"string"===a||"number"===a}function r(a){return"function"===typeof a}function K(a){for(var b=arguments,c=1;c<b.length;c++)for(var d in b[c])a[d]=b[c][d];return a}function na(a,b){for(var c=[];b<a.length;b++)c.push(a[b]);return c}function oa(a,
b){for(var c in a)if(a[c]!==b[c])return!1;return!0}function pa(a,b){var c=a.length;if(b.length!==c)return!1;for(var d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}function qa(a){function b(){c=0;a.apply(d,e)}if(!ra)return a;var c,d,e;return function(){d=this;e=arguments;c||(c=ra(b))}}function Ra(a,b,c){return function(){return a.apply(c,b)}}function Sa(a){var b=a.slice(),c=[];c.push(0);for(var d,e,f=0,h=a.length;f<h;++f)if(d=c[c.length-1],a[d]<a[f])b[f]=d,c.push(f);else{d=0;for(e=c.length-1;d<e;){var g=
(d+e)/2|0;a[c[g]]<a[f]?d=g+1:e=g}a[f]<a[c[d]]&&(0<d&&(b[f]=c[d-1]),c[d]=f)}d=c.length;for(e=c[d-1];0<d--;)c[d]=e,e=b[e];return c}function O(a){return"o"===a[0]&&"n"===a[1]}function P(a){a&&a.el&&a.el.offsetHeight}function Z(a){return null!=a.node&&null!=a.node.el}function Q(a,b){switch(b){case "value":case "checked":case "selected":return!0}return!1}function H(a){for(a=a||D;null==a.vm&&a.parent;)a=a.parent;return a.vm}function I(){}function sa(a){var b=new I;b.type=2;b.body=a;return b}function aa(a,
b){var c=ba(a,function(a){c&&(null!=b.node&&b.redraw(),R(c))});return ta(a)}function ua(a,b){var c=ba(a,function(a){c&&null!=b.node&&b.redraw()});return c}function Ta(a){var b=va[a];if(null==b){var c,d,e;for(va[a]=b={tag:(c=a.match(/^[-\w]+/))?c[0]:"div",id:(d=a.match(/#([-\w]+)/))?d[1]:null,class:(e=a.match(/\.([-\w.]+)/))?e[1].replace(/\./g," "):null,attrs:null};c=Ua.exec(a);)null==b.attrs&&(b.attrs={}),b.attrs[c[1]]=c[2]||""}return b}function w(a,b){x.warnings&&r(x[a])&&(b=x[a].apply(null,b))&&
(b[0]=a+": "+(x.verbose?b[0]:""),console.warn.apply(console,b))}function wa(a,b,c,d){var e=new I;e.type=1;null!=d&&(e.flags=d);e.attrs=b;a=Ta(a);e.tag=a.tag;if(a.id||a.class||a.attrs){b=e.attrs||{};a.id&&null==b.id&&(b.id=a.id);a.class&&(e._class=a.class,b.class=a.class+(null!=b.class?" "+b.class:""));if(a.attrs)for(var f in a.attrs)null==b[f]&&(b[f]=a.attrs[f]);e.attrs=b}f=e.attrs;null!=f&&(null!=f._key&&(e.key=f._key),null!=f._ref&&(e.ref=f._ref),null!=f._hooks&&(e.hooks=f._hooks),null!=f._data&&
(e.data=f._data),null!=f._flags&&(e.flags=f._flags),null==e.key&&(null!=e.ref?e.key=e.ref:null!=f.id?e.key=f.id:null!=f.name&&(e.key=f.name+("radio"===f.type||"checkbox"===f.type?f.value:""))));null!=c&&(e.body=c);"svg"===e.tag?setTimeout(function(){null==e.ns&&w("SVG_WRONG_FACTORY",[e])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(e.tag)&&null==e.key&&w("UNKEYED_INPUT",[e]);return e}function E(a,b,c,d){if(5!==a.type&&4!==a.type){a.parent=b;a.idx=c;a.vm=d;if(null!=a.ref){c=H(a);
b=["refs"].concat(a.ref.split("."));for(var e;e=b.shift();)c[e]=0===b.length?a:c=c[e]||{}}b=a.hooks;d=d&&d.hooks;if(b&&(b.willRemove||b.didRemove)||d&&(d.willUnmount||d.didUnmount))for(d=a;d=d.parent;)d.flags|=1;if(m(a.body))for(d=a.body,b=0;b<d.length;b++)c=d[b],!1===c||null==c?d.splice(b--,1):m(c)?(0!==b&&b!==d.length-1||w("ARRAY_FLATTENED",[a,c]),e=b--,d.splice.apply(d,[e,1].concat(c))):(null==c.type&&(d[b]=c=sa(""+c)),2===c.type?null==c.body||""===c.body?d.splice(b--,1):0<b&&2===d[b-1].type?(w("ADJACENT_TEXT",
[a,d[b-1].body,c.body]),d[b-1].body+=c.body,d.splice(b--,1)):E(c,a,b,null):E(c,a,b,null));else F(a.body)&&(a.body=aa(a.body,H(a)))}}function xa(a,b){return isNaN(b)||Va[a]?b:b+"px"}function y(a,b,c,d,e){if(null!=a&&(a=c.hooks[b]))if("d"===b[0]&&"i"===b[1]&&"d"===b[2])e?P(c.parent)&&a(c,d):ca.push([a,c,d]);else return a(c,d)}function S(a){if(ca.length)for(P(a.node);a=ca.shift();)a[0](a[1],a[2])}function ya(a){var b=a.vm;b=null!=b&&y(b.hooks,"willUnmount",b,b.data);var c=y(a.hooks,"willRemove",a);if(1===
(a.flags&1)&&m(a.body))for(var d=0;d<a.body.length;d++)ya(a.body[d]);return b||c}function da(a,b,c){var d=b._node,e=d.vm;if(m(d.body))if(1===(d.flags&1))for(var f=0;f<d.body.length;f++)da(b,d.body[f].el);else ea(d);delete b._node;a.removeChild(b);y(d.hooks,"didRemove",d,null,c);null!=e&&(y(e.hooks,"didUnmount",e,e.data,c),e.node=null)}function T(a,b){var c=b._node;if(!c._dead){var d=ya(c);null!=d&&"object"===typeof d&&r(d.then)?(c._dead=!0,d.then(Ra(da,[a,b,!0]))):da(a,b)}}function ea(a){a=a.body;
for(var b=0;b<a.length;b++){var c=a[b];delete c.el._node;null!=c.vm&&(c.vm.node=null);m(c.body)&&ea(c)}}function U(a){var b=a.el;if(0===(a.flags&1))m(a.body)&&ea(a),b.textContent=null;else{a=b.firstChild;do{var c=a.nextSibling;T(b,a)}while(a=c)}}function t(a,b,c){var d=b._node,e=null!=b.parentNode,f=b!==c&&e?null:d.vm;null!=f&&y(f.hooks,"willMount",f,f.data);y(d.hooks,e?"willReinsert":"willInsert",d);a.insertBefore(b,c);y(d.hooks,e?"didReinsert":"didInsert",d);null!=f&&y(f.hooks,"didMount",f,f.data)}
function za(a,b,c){t(a,b,c?c.nextSibling:null)}function Aa(a,b,c,d,e){a=a.apply(e,b.concat([c,d,e,e.data]));e.onevent(c,d,e,e.data,b);fa.call(null,c,d,e,e.data,b);!1===a&&(c.preventDefault(),c.stopPropagation())}function Wa(a){var b;for(b=a.target;null==b._node;)b=b.parentNode;b=b._node;var c=H(b),d=a.currentTarget._node.attrs["on"+a.type];if(m(d)){var e=d[0];var f=d.slice(1);Aa(e,f,a,b,c)}else for(var h in d)a.target.matches(h)&&(f=d[h],m(f)?(e=f[0],f=f.slice(1)):(e=f,f=[]),Aa(e,f,a,b,c))}function Ba(a,
b,c,d){c!==d&&(r(c)&&r(d)&&d.name==c.name&&w("INLINE_HANDLER",[a,d,c]),null==d||null==c||m(d)==m(c)&&A(d)==A(c)&&r(d)==r(c)||w("MISMATCHED_HANDLER",[a,d,c]),a=a.el,null==c||r(c)?a[b]=c:null==d&&(a[b]=Wa))}function Ca(a,b,c){"."===b[0]&&(b=b.substr(1),c=!0);c?a.el[b]="":a.el.removeAttribute(b)}function Da(a,b,c,d,e){var f=a.el;null==c?!e&&Ca(a,b,!1):null!=a.ns?f.setAttribute(b,c):"class"===b?f.className=c:"id"===b||"boolean"===typeof c||d?f[b]=c:"."===b[0]?f[b.substr(1)]=c:f.setAttribute(b,c)}function ha(a,
b,c){var d=a.attrs||D,e=b.attrs||D;if(d===e)w("REUSED_ATTRS",[a]);else{for(var f in d){var h=d[f],g=Q(a.tag,f),l=g?a.el[f]:e[f];F(h)&&(d[f]=h=aa(h,H(a)));if(h!==l)if("style"===f){g=h=void 0;l=a;var p=(l.attrs||D).style,z=b?(b.attrs||D).style:null;if(null==p||ma(p))l.el.style.cssText=p;else{for(g in p){var k=p[g];F(k)&&(k=aa(k,H(l)));if(null==z||null!=k&&k!==z[g])l.el.style[g]=xa(g,k)}if(z)for(h in z)null==p[h]&&(l.el.style[h]="")}}else"_"!==f[0]&&(O(f)?Ba(a,f,h,l):Da(a,f,h,g,c))}for(f in e)f in d||
"_"===f[0]||Ca(a,f,Q(a.tag,f)||O(f))}}function L(a,b,c,d){4===a.type&&(b=a.data,c=a.key,d=a.opts,a=a.view);return new V(a,b,c,d)}function Ea(a){for(var b=0;b<a.body.length;b++){var c=a.body[b],d=c.type;3>=d?t(a.el,J(c)):4===d?(c=L(c.view,c.data,c.key,c.opts)._redraw(a,b,!1),t(a.el,J(c.node))):5===d&&(c=c.vm,c._redraw(a,b),t(a.el,c.node.el))}}function J(a,b){if(null==a.el)if(1===a.type){if(!b){b=a.tag;var c=a.ns;b=null!=c?W.createElementNS(c,b):W.createElement(b)}a.el=b;null!=a.attrs&&ha(a,D,!0);8===
(a.flags&8)&&a.body.body(a);m(a.body)?Ea(a):null!=a.body&&""!==a.body&&(a.el.textContent=a.body)}else 2===a.type?a.el=b||W.createTextNode(a.body):3===a.type&&(a.el=b||W.createComment(a.body));a.el._node=a;return a.el}function Fa(a,b,c,d,e,f,h,g){return function(l,p,z,k,q,m){var v;if(null!=k[d]){if(null==(v=k[d]._node)){w("FOREIGN_ELEMENT",[k[d]]);k[d]=a(k[d]);return}if(v.parent!==l){l=a(k[d]);null!=v.vm?v.vm.unmount(!0):T(p,k[d]);k[d]=l;return}}if(k[e]==q)return 2;if(null==k[e].el)c(p,J(k[e]),k[d]),
k[e]=b(k[e],z);else if(k[e].el===k[d])k[e]=b(k[e],z),k[d]=a(k[d]);else{if(m||v!==k[h])return null!=k[e].vm&&w("ALREADY_HYDRATED",[k[e].vm]),m&&null!=k[d]?Ga(a,b,c,d,e,p,z,v,k):1;l=k[d];k[d]=a(l);g(p,l,k[f]);k[f]=l}}}function Ga(a,b,c,d,e,f,h,g,l){if(g._lis)c(f,l[e].el,l[d]),l[e]=b(l[e],h);else{a:{b=g.idx;e=l.tombs;var p=0,m=e.length-1;if(2147483647>=m)for(;p<=m;){var k=p+m>>1;if(e[k]===b){b=k;break a}else e[k]<b?p=k+1:m=k-1}else for(;p<=m;)if(k=Math.floor((p+m)/2),e[k]===b){b=k;break a}else e[k]<
b?p=k+1:m=k-1;b=p==e.length?null:p}g._lis=!0;a=a(l[d]);c(f,l[d],null!=b?h[l.tombs[b]].el:b);null==b?l.tombs.push(g.idx):l.tombs.splice(b,0,g.idx);l[d]=a}}function Xa(a,b,c,d){for(var e=Array.prototype.slice.call(b.childNodes),f=[],h=0;h<e.length;h++){var g=e[h]._node;g.parent===a&&f.push(g.idx)}e=Sa(f).map(function(a){return f[a]});for(h=0;h<e.length;h++)c[e[h]]._lis=!0;for(d.tombs=e;2!==Ha(a,b,c,d,null,!0););}function Ia(a){return a.el._node.parent!==a.parent}function Ya(a,b,c){return b[c]}function Za(a,
b,c){for(;c<b.length;c++){var d=b[c];if(null!=d.vm){if(4===a.type&&d.vm.view===a.view&&d.vm.key===a.key||5===a.type&&d.vm===a.vm)return d}else if(!Ia(d)&&a.tag===d.tag&&a.type===d.type&&a.key===d.key&&(a.flags&-2)===(d.flags&-2))return d}return null}function $a(a,b,c){return b[b._keys[a.key]]}function X(a,b){y(b.hooks,"willRecycle",b,a);var c=a.el=b.el,d=b.body,e=a.body;c._node=a;if(2===a.type&&e!==d)c.nodeValue=e;else{null==a.attrs&&null==b.attrs||ha(a,b,!1);var f=m(d),h=m(e),g=8===(a.flags&8);if(f)if(h||
g){c=a.body;d=c.length;e=b.body;f=e.length;h=8===(a.flags&8);var l=2===(a.flags&2);g=4===(a.flags&4);var p=!l&&1===a.type,z=!0;l=g?$a:l||h?Ya:Za;if(g){for(var k={},q=0;q<e.length;q++)k[e[q].key]=q;e._keys=k}if(p&&0===d)U(b),h&&(a.body=[]);else{k=0;var w=!1,v=0;if(h)var t={key:null},A=Array(d);for(q=0;q<d;q++){if(h){var r=!1,x=null;if(z){g&&(t.key=c.key(q));var u=l(t,e,v)}if(null!=u){var B=u.idx;x=c.diff(q,u);if(!0===x){var n=u;n.parent=a;n.idx=q;n._lis=!1}else r=!0}else r=!0;r&&(n=c.tpl(q),E(n,a,
q),n._diff=null!=x?x:c.diff(q),null!=u&&X(n,u));A[q]=n}else if(n=c[q],r=n.type,3>=r){if(u=z&&l(n,e,v))X(n,u),B=u.idx}else 4===r?(u=z&&l(n,e,v))?(B=u.idx,u.vm._update(n.data,a,q)):L(n.view,n.data,n.key,n.opts)._redraw(a,q,!1):5===r&&(r=Z(n.vm),n.vm._update(n.data,a,q,r));if(!g&&null!=u&&(B===v?(v++,v===f&&d>f&&(u=null,z=!1)):w=!0,100<f&&w&&0===++k%10))for(;v<f&&Ia(e[v]);)v++}h&&(a.body=A);if(p)b:for(B=b.body,u=a.el,n=a.body,B={lftNode:n[0],rgtNode:n[n.length-1],lftSib:(B[0]||D).el,rgtSib:(B[B.length-
1]||D).el};;){for(;;){t=Ha(a,u,n,B,null,!1);if(1===t)break;if(2===t)break b}for(;;){t=ab(a,u,n,B,B.lftNode,!1);if(1===t)break;if(2===t)break b}Xa(a,u,n,B);break}}}else e!==d&&(null!=e?c.textContent=e:U(b));else h?(U(b),Ea(a)):e!==d&&(c.firstChild?c.firstChild.nodeValue=e:c.textContent=e);y(b.hooks,"didRecycle",b,a)}}function V(a,b,c,d){var e=this;e.view=a;e.data=b;e.key=c;F(b)&&(e._stream=ua(b,e));d&&(e.opts=d,e.config(d));a=A(a)?a:a.call(e,e,b,c,d);r(a)?e.render=a:(e.render=a.render,e.config(a));
e._redrawAsync=qa(function(a){return e.redraw(!0)});e._updateAsync=qa(function(a){return e.update(a,!0)});e.init&&e.init.call(e,e,e.data,e.key,d)}function Ja(a,b,c,d){null!=c&&(c.body[d]=b,b.idx=d,b.parent=c,b._lis=!1);return a}function Ka(a,b,c,d){var e,f;null==c?A(b)?e=b:f=b:(e=b,f=c);return wa(a,e,f,d)}function ia(a,b,c,d){this.view=a;this.data=b;this.key=c;this.opts=d}function ja(a){this.vm=a}function La(a,b){a=a.body;if(m(a))for(var c=0;c<a.length;c++){var d=a[c];null!=d.vm?b.push(d.vm):La(d,
b)}return b}function Ma(a){var b=arguments,c=b.length;if(1<c){var d=1;if(A(b[1])){var e=b[1];d=2}d=c===d+1&&(ma(b[d])||m(b[d])||e&&8===(e._flags&8))?b[d]:na(b,d)}return wa(a,e,d)}function Na(a,b){a.el=b;b._node=a;var c=a.attrs;for(f in c){var d=c[f],e=Q(a.tag,f);"style"!==f&&"_"!==f[0]&&(O(f)?Ba(a,f,d):null!=d&&e&&Da(a,f,d,e))}8===(a.flags&8)&&a.body.body(a);if(m(a.body)&&0<a.body.length){b=b.firstChild;c=0;var f=a.body[c];do 4===f.type?f=L(f.view,f.data,f.key,f.opts)._redraw(a,c,!1).node:5===f.type&&
(f=f.node||f._redraw(a,c,!1).node),"table"===a.tag&&"tr"===f.tag&&w("ATTACH_IMPLICIT_TBODY",[a,f]),Na(f,b);while((b=b.nextSibling)&&(f=a.body[++c]))}}function M(a){a=null==a?"":""+a;for(var b=0,c="";b<a.length;b++)switch(a[b]){case "&":c+="&amp;";break;case "<":c+="&lt;";break;case ">":c+="&gt;";break;default:c+=a[b]}return c}function Oa(a){a=null==a?"":""+a;for(var b=0,c="";b<a.length;b++)c+='"'===a[b]?"&quot;":a[b];return c}function Pa(a,b){for(var c="",d=0;d<a.length;d++)c+=
ka(a[d],b);return c}function ka(a,b){switch(a.type){case 4:var c=L(a.view,a.data,a.key,a.opts).html(b);break;case 5:c=a.vm.html();break;case 1:if(null!=a.el&&null==a.tag){c=a.el.outerHTML;break}c="<"+a.tag;var d=a.attrs,e=null!=d;if(e){for(var f in d)if(!(O(f)||"."===f[0]||"_"===f[0]||!1===b&&Q(a.tag,f))){var h=d[f];if("style"===f&&null!=h)if("object"===typeof h){var g=void 0;var l="";for(g in h)null!=h[g]&&(l+=g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+xa(g,h[g])+"; ");g=l}else g=
h;else!0===h?c+=" "+M(f)+'=""':!1!==h&&null!=h&&(c+=" "+M(f)+'="'+Oa(h)+'"')}null!=g&&(c+=' style="'+Oa(g.trim())+'"')}if(null==a.body&&null!=a.ns&&"svg"!==a.tag)return c+"/>";c+=">";bb[a.tag]||(e&&null!=d[Qa]?c+=d[Qa]:m(a.body)?c+=Pa(a.body,b):8===(a.flags&8)?(a.body.body(a),c+=Pa(a.body,b)):c+=M(a.body),c+="</"+a.tag+">");break;case 2:c=M(a.body);break;case 3:c="<!--"+M(a.body)+"-->"}return c}var N="undefined"!==typeof window,C=N?window:{},W=N?document:{},ra=C.requestAnimationFrame,
D={},m=Array.isArray;N=I.prototype={constructor:I,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null};var F=function(){return!1},ta=G,ba=G,R=G,va={},Ua=/\[(\w+)(?:=(\w+))?\]/g,x={syncRedraw:!1,warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(a,b,c){if(r(a.view)&&1<a.view.length)return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",
a,b,c]},UNKEYED_INPUT:function(a){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",a]},UNMOUNTED_REDRAW:function(a){return["Invoking redraw() of an unmounted (sub)view may result in errors.",a]},INLINE_HANDLER:function(a,b,c){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",a,b,c]},MISMATCHED_HANDLER:function(a,
b,c){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",a,b,c]},SVG_WRONG_FACTORY:function(a){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",a]},FOREIGN_ELEMENT:function(a){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",
a]},REUSED_ATTRS:function(a){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",a]},ADJACENT_TEXT:function(a,b,c){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",a,b,c]},ARRAY_FLATTENED:function(a,b){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",
a,b]},ALREADY_HYDRATED:function(a){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",a]},ATTACH_IMPLICIT_TBODY:function(a,b){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",a,b]}},Va={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,
boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ca=[],la={},fa=G;var Ha=Fa(function(a){return a.nextSibling},
function(a,b){return b[a.idx+1]},t,"lftSib","lftNode","rgtSib","rgtNode",za),ab=Fa(function(a){return a.previousSibling},function(a,b){return b[a.idx-1]},za,"rgtSib","rgtNode","lftSib","lftNode",t);C=V.prototype={constructor:V,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:G,refs:null,render:null,mount:function(a,b){x.mutations&&null.start();b?(U({el:a,flags:0}),this._redraw(null,null,!1),a.nodeName.toLowerCase()!==this.node.tag?(J(this.node),
t(a.parentNode,this.node.el,a),a.parentNode.removeChild(a)):t(a.parentNode,J(this.node,a),a)):(this._redraw(null,null),a&&t(a,this.node.el));a&&S(this);x.mutations&&console.log(null.end());return this},unmount:function(a){F(this._stream)&&R(this._stream);var b=this.node;T(b.el.parentNode,b.el);a||S(this)},config:function(a){a.init&&(this.init=a.init);a.diff&&(this.diff=a.diff);a.onevent&&(this.onevent=a.onevent);a.hooks&&(this.hooks=K(this.hooks||{},a.hooks));a.onemit&&(this.onemit=K(this.onemit||
{},a.onemit))},parent:function(){return H(this.node.parent)},root:function(){for(var a=this.node;a.parent;)a=a.parent;return a.vm},redraw:function(a){x.syncRedraw&&(a=!0);a?this._redraw(null,null,Z(this)):this._redrawAsync();return this},update:function(a,b){x.syncRedraw&&(b=!0);b?this._update(a,null,null,Z(this)):this._updateAsync(a);return this},_update:function(a,b,c,d){null!=a&&this.data!==a&&(w("DATA_REPLACED",[this,this.data,a]),y(this.hooks,"willUpdate",this,a),this.data=a,F(this._stream)&&
R(this._stream),F(a)&&(this._stream=ua(a,this)));return this._redraw(b,c,d)},_redraw:function(a,b,c){var d=null==a,e=this.node&&this.node.el&&this.node.el.parentNode;d&&this.node&&this.node.el&&!this.node.el.parentNode&&w("UNMOUNTED_REDRAW",[this]);var f=this.node,h;if(null!=this.diff){var g=this._diff;this._diff=h=this.diff(this,this.data);if(null!=f){var l=m(g)?pa:oa;if(g===h||l(g,h))return Ja(this,f,a,b)}}e&&y(this.hooks,"willRedraw",this,this.data);g=this.render.call(this,this,this.data,g,h);
if(g===f)return Ja(this,f,a,b);this.refs=null;null!=this.key&&g.key!==this.key&&(g.key=this.key);this.node=g;a?(E(g,a,b,this),a.body[b]=g):f&&f.parent?(E(g,f.parent,f.idx,this),f.parent.body[f.idx]=g):E(g,null,null,this);!1!==c&&(f?f.tag!==g.tag||f.key!==g.key?(f.vm=g.vm=null,a=f.el.parentNode,b=f.el.nextSibling,T(a,f.el),t(a,J(g),b),f.el=g.el,g.vm=this):X(g,f):J(g));e&&y(this.hooks,"didRedraw",this,this.data);d&&e&&S(this);return this},_redrawAsync:null,_updateAsync:null};ia.prototype={constructor:ia,
type:4,view:null,data:null,key:null,opts:null};ja.prototype={constructor:ja,type:5,vm:null};var Y={config:function(a){fa=a.onevent||fa;a.onemit&&K(la,a.onemit);a.stream&&(a=a.stream,F=a.is,ta=a.val,ba=a.sub,R=a.unsub)},ViewModel:V,VNode:I,createView:L,defineElement:Ka,defineSvgElement:function(a,b,c,d){a=Ka(a,b,c,d);a.ns="http://www.w3.org/2000/svg";return a},defineText:sa,defineComment:function(a){var b=new I;b.type=3;b.body=a;return b},defineView:function(a,b,c,d){return new ia(a,b,c,d)},injectView:function(a){return new ja(a)},
injectElement:function(a){var b=new I;b.type=1;b.el=b.key=a;return b},lazyList:function(a,b){var c=a.length,d={items:a,length:c,key:function(c){return b.key(a[c],c)},diff:function(c,d){c=b.diff(a[c],c);if(null==d)return c;d=d._diff;return(c===d||m(d)?pa(c,d):oa(c,d))||c},tpl:function(c){return b.tpl(a[c],c)},map:function(a){b.tpl=a;return d},body:function(a){for(var b=Array(c),e=0;e<c;e++){var g=d.tpl(e);g._diff=d.diff(e);b[e]=g;E(g,a,e)}a.body=b}};return d},FIXED_BODY:2,DEEP_REMOVE:1,KEYED_LIST:4,
LAZY_LIST:8};N.patch=function(a,b){if(null!=a.type)null==this.vm&&(E(a,this.parent,this.idx,null),this.parent.body[this.idx]=a,X(a,this),b&&P(a),S(H(a)));else{var c=Object.create(this);c.attrs=K({},this.attrs);a=K(this.attrs,a);if(null!=this._class){var d=a.class;a.class=null!=d&&""!==d?this._class+" "+d:this._class}ha(this,c);b&&P(this)}};C.emit=function(a){var b=this,c=b;c=na(arguments,1).concat(c,c.data);do{var d=b.onemit;if(d=d?d[a]:null){d.apply(b,c);break}}while(b=b.parent());la[a]&&la[a].apply(b,
c)};C.onemit=null;C.body=function(){return La(this.node,[])};Y.defineElementSpread=Ma;Y.defineSvgElementSpread=function(){var a=Ma.apply(null,arguments);a.ns="http://www.w3.org/2000/svg";return a};C._stream=null;var bb={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Qa=".innerHTML";C.attach=function(a){null==this.node&&this._redraw(null,null,!1);Na(this.node,a);return this};C.html=function(a){null==this.node&&this._redraw(null,
null,!1);return ka(this.node,a)};N.html=function(a){return ka(this,a)};Y.DEVMODE=x;return Y});